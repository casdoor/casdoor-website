name: Build and Deploy
on:
  push:
      branches:
        - master
jobs:
  build-and-deploy:
    env:
      CROWDIN_PERSONAL_TOKEN: ${{ secrets.CROWDIN_PERSONAL_TOKEN }}
    runs-on: ubuntu-latest
    steps:
      - name: Free Disk Space
        uses: jlumbroso/free-disk-space@main
        with:
          tool-cache: true
          android: true
          dotnet: true
          haskell: true
          large-packages: true
          swap-storage: true

      - name: Checkout üõéÔ∏è
        uses: actions/checkout@v3

      - name: Cache dependencies
        uses: actions/cache@v3
        with:
          path: ~/.cache/yarn
          key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}
          restore-keys: |
            ${{ runner.os }}-yarn-

      - name: Use Node.js 20.x
        uses: actions/setup-node@v4
        with:
          node-version: '20.x'

      - name: Install and Build üîß
        run: |
          yarn install
          yarn crowdin:sync
          yarn build

      - name: Deploy üöÄ
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          ssh-key: ${{ secrets.DEPLOY_KEY }}
          git-config-name: ${{ secrets.GH_NAME }}
          git-config-email: ${{ secrets.GH_EMAIL }}
          repository-name: casdoor/casdoor.github.io
          branch: master # The deploy branch.
          folder: build # The deploy folder.
